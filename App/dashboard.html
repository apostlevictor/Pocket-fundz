<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pocket Investie ‚Äì ROI Dashboard</title>
  
  <!-- Tailwind via CDN for rapid styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Enhanced gradient background with animated effect */
    body {
      background: linear-gradient(-45deg, #d32f2f, #9c27b0, #1a237e, #0d47a1);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      @apply m-0 p-0 min-h-screen flex flex-col text-white;
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Enhanced frosted glass effect */
    .frosted {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    /* Scrollable transaction list */
    #txList {
      max-height: 250px;
      overflow-y: auto;
    }
    
    /* Custom scrollbar */
    #txList::-webkit-scrollbar {
      width: 8px;
    }
    
    #txList::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    
    #txList::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
    }
    
    /* Animation for values */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .value-change {
      animation: pulse 0.5s ease-in-out;
    }
    
    /* Dropdown styling */
    .dropdown {
      transition: all 0.3s ease;
      max-height: 0;
      overflow: hidden;
    }
    
    .dropdown.open {
      max-height: 500px;
    }
  </style>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'invest-green': '#00c853',
            'invest-blue': '#2962ff',
            'invest-purple': '#aa00ff',
            'invest-red': '#ff1744',
          }
        }
      }
    }
  </script>
</head>
<body class="overflow-hidden">

  <!-- Enhanced Header with Navigation Dropdown -->
  <header class="p-4 flex justify-between items-center relative z-10">
    <div>
      <h1 class="text-2xl font-bold flex items-center">
        <i class="fas fa-piggy-bank mr-2 text-green-300"></i>
        Pocket Investie
      </h1>
      <p class="text-sm opacity-80">Invest Smart, Grow Your Wealth</p>
    </div>
    
    <div class="relative">
      <button id="navToggle" class="text-xl p-2 rounded-full hover:bg-white/20 transition">
        <i class="fas fa-bars"></i>
      </button>
      
      <div id="navDropdown" class="dropdown absolute right-0 mt-2 w-56 frosted">
        <div class="p-2">
          <div class="p-2 border-b border-white/20">
            <p class="text-sm">Navigation</p>
          </div>
          <a href="dashboard.html" class="flex items-center p-3 hover:bg-white/10 rounded-lg transition">
            <i class="fas fa-home mr-3 text-green-300"></i>
            <span>Dashboard Home</span>
          </a>
          <a href="deposit.html" class="flex items-center p-3 hover:bg-white/10 rounded-lg transition">
            <i class="fas fa-money-bill-wave mr-3 text-blue-300"></i>
            <span>Deposit Funds</span>
          </a>
          <a href="withdraw.html" class="flex items-center p-3 hover:bg-white/10 rounded-lg transition">
            <i class="fas fa-wallet mr-3 text-purple-300"></i>
            <span>Withdraw Earnings</span>
          </a>
          <a href="invest.html" class="flex items-center p-3 hover:bg-white/10 rounded-lg transition">
            <i class="fas fa-chart-line mr-3 text-yellow-300"></i>
            <span>Investment Plans</span>
          </a>
          <a href="profile.html" class="flex items-center p-3 hover:bg-white/10 rounded-lg transition">
            <i class="fas fa-user mr-3 text-pink-300"></i>
            <span>My Profile</span>
          </a>
          <div class="p-3 mt-2 border-t border-white/20">
            <button id="logoutBtn" class="w-full py-2 bg-red-500 rounded-lg font-medium hover:bg-red-600 transition flex items-center justify-center">
              <i class="fas fa-sign-out-alt mr-2"></i>
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 p-4 overflow-auto pb-24">
    <p class="text-xs text-right mb-2">Logged in as <span id="userEmail" class="font-semibold bg-white/10 px-2 py-1 rounded-full"></span></p>

    <!-- Portfolio Summary Cards -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="frosted p-5 relative overflow-hidden">
        <div class="absolute -right-4 -top-4 w-20 h-20 rounded-full bg-green-500/20"></div>
        <div class="flex items-start justify-between">
          <div>
            <h2 class="font-semibold text-lg flex items-center">
              <i class="fas fa-wallet mr-2"></i>
              Wallet Balance
            </h2>
            <p id="wallet" class="text-3xl font-bold text-green-300 mt-2">‚Ç¶0</p>
          </div>
          <i class="fas fa-coins text-3xl opacity-20"></i>
        </div>
        <p class="text-xs mt-3 opacity-70">Available for withdrawal or investment</p>
      </div>
      
      <div class="frosted p-5 relative overflow-hidden">
        <div class="absolute -right-4 -top-4 w-20 h-20 rounded-full bg-blue-500/20"></div>
        <div class="flex items-start justify-between">
          <div>
            <h2 class="font-semibold text-lg flex items-center">
              <i class="fas fa-chart-line mr-2"></i>
              Total Returns
            </h2>
            <p id="roi" class="text-3xl font-bold text-blue-300 mt-2">‚Ç¶0</p>
          </div>
          <i class="fas fa-money-bill-trend-up text-3xl opacity-20"></i>
        </div>
        <p class="text-xs mt-3 opacity-70">Your investment returns to date</p>
      </div>
      
      <div class="frosted p-5 relative overflow-hidden">
        <div class="absolute -right-4 -top-4 w-20 h-20 rounded-full bg-purple-500/20"></div>
        <div class="flex items-start justify-between">
          <div>
            <h2 class="font-semibold text-lg flex items-center">
              <i class="fas fa-lock mr-2"></i>
              Active Investment
            </h2>
            <p id="investment" class="text-xl opacity-90 mt-2">None</p>
            <p id="investmentValue" class="text-lg font-bold text-purple-300">‚Ç¶0</p>
          </div>
          <i class="fas fa-sack-dollar text-3xl opacity-20"></i>
        </div>
        <p id="investmentStatus" class="text-xs mt-3 opacity-70">No active investments</p>
      </div>
    </section>

    <!-- Performance Charts -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- ROI Chart -->
      <div class="frosted p-5">
        <div class="flex justify-between items-center mb-4">
          <h2 class="font-semibold text-lg">ROI Performance</h2>
          <div class="flex space-x-2">
            <button class="text-xs bg-white/10 px-2 py-1 rounded">1M</button>
            <button class="text-xs bg-blue-500 px-2 py-1 rounded">6M</button>
            <button class="text-xs bg-white/10 px-2 py-1 rounded">1Y</button>
          </div>
        </div>
        <canvas id="roiChart" class="w-full h-64"></canvas>
      </div>
      
      <!-- Portfolio Distribution -->
      <div class="frosted p-5">
        <h2 class="font-semibold text-lg mb-4">Portfolio Allocation</h2>
        <canvas id="portfolioChart" class="w-full h-64"></canvas>
      </div>
    </section>

    <!-- Transaction History -->
    <section class="frosted p-5 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-semibold text-lg">Recent Transactions</h2>
        <button class="text-sm bg-white/10 px-3 py-1 rounded-full">View All</button>
      </div>
      <ul id="txList" class="space-y-3"></ul>
    </section>

    <!-- Quick Stats -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="frosted p-4 text-center">
        <div class="text-2xl mb-1"><i class="fas fa-percentage"></i></div>
        <p class="text-sm opacity-80">Avg. Return</p>
        <p class="text-lg font-bold text-green-300">0.0%</p>
      </div>
      <div class="frosted p-4 text-center">
        <div class="text-2xl mb-1"><i class="fas fa-calendar"></i></div>
        <p class="text-sm opacity-80">Investment Days</p>
        <p class="text-lg font-bold text-blue-300">00</p>
      </div>
      <div class="frosted p-4 text-center">
        <div class="text-2xl mb-1"><i class="fas fa-trophy"></i></div>
        <p class="text-sm opacity-80">Best Return</p>
        <p class="text-lg font-bold text-purple-300">0.00%</p>
      </div>
      <div class="frosted p-4 text-center">
        <div class="text-2xl mb-1"><i class="fas fa-hand-holding-usd"></i></div>
        <p class="text-sm opacity-80">Withdrawn</p>
        <p class="text-lg font-bold text-yellow-300">‚Ç¶0.00</p>
      </div>
    </section>
  </main>

  <!-- Bottom Navigation for mobile -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white bg-opacity-20 backdrop-blur-sm border-t border-white/30 flex justify-around py-3">
    <a href="dashboard.html" class="flex flex-col items-center text-green-200"><span class="text-xl">üè†</span><span class="text-xs">Home</span></a>
    <a href="deposit.html" class="flex flex-col items-center text-white"><span class="text-xl">üí∞</span><span class="text-xs">Deposit</span></a>
    <a href="withdraw.html" class="flex flex-col items-center text-white"><span class="text-xl">üí∏</span><span class="text-xs">Withdraw</span></a>
    <a href="invest.html" class="flex flex-col items-center text-white"><span class="text-xl">üìà</span><span class="text-xs">Invest</span></a>
  </nav>

  <!-- Firebase & Chart Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, collection, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDQ8AejmnXU8lO1mHdMNoL8G85nmxnYn_A",
      authDomain: "pocket-investie.firebaseapp.com",
      projectId: "pocket-investie",
      storageBucket: "pocket-investie.firebasestorage.app",
      messagingSenderId: "246875262393",
      appId: "1:246875262393:web:f0468ca3f1da95f4b4fa68"
    };

    // Initialize Firebase
    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // DOM Elements
    const walletEl         = document.getElementById("wallet");
    const roiEl            = document.getElementById("roi");
    const investEl         = document.getElementById("investment");
    const investmentValueEl = document.getElementById("investmentValue");
    const investmentStatusEl = document.getElementById("investmentStatus");
    const txList           = document.getElementById("txList");
    const userEmail        = document.getElementById("userEmail");
    const logoutBtn        = document.getElementById("logoutBtn");
    const navToggle        = document.getElementById("navToggle");
    const navDropdown      = document.getElementById("navDropdown");

    let roiChart, portfolioChart;
    let unsubscribeUser = null;
    let unsubscribeTx = null;

    // Toggle dropdown navigation
    navToggle.addEventListener('click', () => {
      navDropdown.classList.toggle('open');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!navToggle.contains(e.target) {
        navDropdown.classList.remove('open');
      }
    });

    // Handle auth state changes
    onAuthStateChanged(auth, async user => {
      if (!user) return location.replace("auth.html");
      
      userEmail.textContent = user.email;
      
      // Clean up previous listeners
      if (unsubscribeUser) unsubscribeUser();
      if (unsubscribeTx) unsubscribeTx();

      // Real-time listener for user document
      unsubscribeUser = onSnapshot(doc(db, "users", user.uid), (docSnap) => {
        if (docSnap.exists()) {
          const userData = docSnap.data();
          const { wallet = 0, roi = 0, investment = "None", investmentAmount = 0, investmentStatus = "No active investments", roiHistory = [] } = userData;
          
          // Animate value changes
          animateValueChange(walletEl, wallet, walletEl.textContent.replace('‚Ç¶', ''));
          animateValueChange(roiEl, roi, roiEl.textContent.replace('‚Ç¶', ''));
          
          investEl.textContent = investment;
          investmentValueEl.textContent = `‚Ç¶${investmentAmount}`;
          investmentStatusEl.textContent = investmentStatus;
          
          // Update charts
          updateRoiChart(roiHistory);
          updatePortfolioChart(userData);
        }
      });

      // Real-time listener for transactions
      unsubscribeTx = onSnapshot(query(
        collection(db, "transactions"),
        where("userId", "==", user.uid),
        orderBy("date", "desc")
      ), (querySnapshot) => {
        txList.innerHTML = "";
        querySnapshot.forEach(doc => {
          const tx = doc.data();
          renderTransaction(tx);
        });
      });
    });

    // Function to animate value changes
    function animateValueChange(element, newValue, oldValue) {
      if (parseFloat(newValue) !== parseFloat(oldValue)) {
        element.classList.add('value-change');
        setTimeout(() => {
          element.classList.remove('value-change');
        }, 500);
      }
      element.textContent = `‚Ç¶${newValue}`;
    }

    // Render transaction item
    function renderTransaction(tx) {
      const { type, amount, date, note } = tx;
      const d = new Date(date.seconds * 1000).toLocaleString();
      
      const bgColor = type === "deposit" ? "bg-green-600/40" :
                      type === "withdraw" ? "bg-blue-600/40" : 
                      "bg-purple-600/40";
      
      const icon = type === "deposit" ? "fa-arrow-down" :
                   type === "withdraw" ? "fa-arrow-up" : 
                   "fa-exchange-alt";
      
      txList.insertAdjacentHTML("beforeend", `
        <li class="p-3 ${bgColor} rounded-lg flex items-start">
          <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center mr-3">
            <i class="fas ${icon}"></i>
          </div>
          <div class="flex-1">
            <div class="flex justify-between">
              <span class="font-semibold capitalize">${type}</span>
              <span class="font-bold">‚Ç¶${amount}</span>
            </div>
            <div class="text-xs opacity-80 mt-1">${d}</div>
            <div class="text-xs mt-1">${note || ""}</div>
          </div>
        </li>
      `);
    }

    // Update ROI Chart
     function updateRoiChart(roiHistory = []) {
      const ctx = document.getElementById("roiChart").getContext("2d");
      
      // Create gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, 250);
      gradient.addColorStop(0, "rgba(0, 200, 83, 0.5)"); // Green
      gradient.addColorStop(1, "rgba(0, 200, 83, 0)");
      
      // Destroy existing chart if it exists
      if (roiChart) roiChart.destroy();
      
      roiChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: roiHistory.map(r => r.month),
          datasets: [{
            label: "ROI (%)",
            data: roiHistory.map(r => r.value),
            borderColor: "#00c853",
            backgroundColor: gradient,
            borderWidth: 3,
            pointRadius: 5,
            pointBackgroundColor: "#fff",
            pointBorderWidth: 2,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { 
            y: { 
              beginAtZero: true, 
              grid: { color: "rgba(255,255,255,0.1)" },
              ticks: { color: "#FFF" } 
            }, 
            x: { 
              grid: { display: false },
              ticks: { color: "#FFF" } 
            } 
          },
          plugins: { 
            legend: { display: false },
            tooltip: {
              backgroundColor: "rgba(0,0,0,0.7)",
              titleFont: { size: 14 },
              bodyFont: { size: 13 },
              padding: 12,
              displayColors: false
            }
          }
        }
      });
    }

    // Update Portfolio Chart
    function updatePortfolioChart(userData) {
      const ctx = document.getElementById("portfolioChart").getContext("2d");
      
      // Destroy existing chart if it exists
      if (portfolioChart) portfolioChart.destroy();
      
      portfolioChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["Stocks", "Crypto", "Real Estate", "Commodities"],
          datasets: [{
            data: [35, 25, 20, 20],
            backgroundColor: [
              "rgba(41, 98, 255, 0.8)", // Blue
              "rgba(170, 0, 255, 0.8)", // Purple
              "rgba(0, 200, 83, 0.8)",  // Green
              "rgba(255, 23, 68, 0.8)"  // Red
            ],
            borderWidth: 0,
            hoverOffset: 10
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: "65%",
          plugins: {
            legend: {
              position: "bottom",
              labels: {
                color: "#fff",
                padding: 15,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              backgroundColor: "rgba(0,0,0,0.7)",
              titleFont: { size: 13 },
              bodyFont: { size: 12 },
              padding: 10
            }
          }
        }
      });
    }

    // Logout functionality
    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => {
        location.replace("auth.html");
      });
    });
   </script>
</body>
</html>
