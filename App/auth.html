<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Investie - Authentication</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <img src="logo.png" alt="Pocket Investie Logo" class="logo">
            <h1>Welcome to Pocket Investie</h1>
            <p>Invest Smart, Grow Your Wealth</p>
        </div>

        <div class="auth-tabs">
            <button class="tab-btn active" id="login-tab">Login</button>
            <button class="tab-btn" id="register-tab">Register</button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="auth-form active">
            <div class="form-group">
                <label for="login-email">Email</label>
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="login-email" placeholder="your@email.com" required>
                </div>
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="login-password" placeholder="••••••••" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
            </div>
            <button type="submit" class="auth-btn" id="login-btn">
                <span class="btn-text">Login</span>
                <i class="fas fa-spinner fa-spin loading-icon"></i>
            </button>
            <p class="auth-footer">Forgot password? <a href="#" id="reset-password">Reset here</a></p>
        </form>

        <!-- Registration Form -->
        <form id="register-form" class="auth-form">
            <div class="form-group">
                <label for="reg-name">Full Name</label>
                <div class="input-with-icon">
                    <i class="fas fa-user"></i>
                    <input type="text" id="reg-name" placeholder="John Doe" required>
                </div>
            </div>
            <div class="form-group">
                <label for="reg-email">Email</label>
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="reg-email" placeholder="your@email.com" required>
                </div>
            </div>
            <div class="form-group">
                <label for="reg-phone">Phone Number</label>
                <div class="input-with-icon">
                    <i class="fas fa-phone"></i>
                    <input type="tel" id="reg-phone" placeholder="+2348123456789" required>
                </div>
            </div>
            <div class="form-group">
                <label for="reg-password">Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="reg-password" placeholder="••••••••" required>
                    <i class="fas fa-eye toggle-password"></i>
                </div>
                <div class="password-hint">Minimum 8 characters with numbers</div>
            </div>
            <div class="form-group">
                <input type="checkbox" id="terms" required>
                <label for="terms">I agree to the <a href="#">Terms</a> and <a href="#">Privacy Policy</a></label>
            </div>
            <button type="submit" class="auth-btn" id="register-btn">
                <span class="btn-text">Create Account</span>
                <i class="fas fa-spinner fa-spin loading-icon"></i>
            </button>
        </form>

        <div class="auth-footer">
            <p>Already have an account? <a href="#" id="switch-to-login">Login here</a></p>
        </div>
    </div>

    <!-- Firebase and App Scripts -->
    <script type="module">
        // Import Firebase functions
        import { 
            auth, 
            db, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            sendPasswordResetEmail,
            doc, 
            setDoc,
            serverTimestamp
        } from './firebase.js';

        // DOM Elements
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const resetPasswordLink = document.getElementById('reset-password');

        // Tab Switching
        loginTab.addEventListener('click', () => switchTab('login'));
        registerTab.addEventListener('click', () => switchTab('register'));
        document.getElementById('switch-to-login').addEventListener('click', (e) => {
            e.preventDefault();
            switchTab('login');
        });

        function switchTab(tab) {
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            } else {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.add('active');
                loginForm.classList.remove('active');
            }
        }

        // Password Visibility Toggle
        document.querySelectorAll('.toggle-password').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                this.classList.toggle('fa-eye-slash');
            });
        });

        // Login Handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');

            try {
                loginBtn.disabled = true;
                loginBtn.querySelector('.loading-icon').style.display = 'inline-block';
                loginBtn.querySelector('.btn-text').textContent = 'Authenticating...';

                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('User logged in:', userCredential.user.uid);
                window.location.href = 'dashboard.html';
            } catch (error) {
                alert('Login failed: ' + error.message);
            } finally {
                loginBtn.disabled = false;
                loginBtn.querySelector('.loading-icon').style.display = 'none';
                loginBtn.querySelector('.btn-text').textContent = 'Login';
            }
        });

        // Registration Handler
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const password = document.getElementById('reg-password').value;
            const registerBtn = document.getElementById('register-btn');

            try {
                registerBtn.disabled = true;
                registerBtn.querySelector('.loading-icon').style.display = 'inline-block';
                registerBtn.querySelector('.btn-text').textContent = 'Creating account...';

                // 1. Create Firebase Auth user
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const userId = userCredential.user.uid;

                // 2. Save user data to Firestore
                await setDoc(doc(db, 'users', userId), {
                    name,
                    email,
                    phone,
                    balance: 0,
                    invested: 0,
                    profit: 0,
                    kycVerified: false,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });

                alert('Account created successfully!');
                window.location.href = 'dashboard.html';
            } catch (error) {
                alert('Registration failed: ' + error.message);
            } finally {
                registerBtn.disabled = false;
                registerBtn.querySelector('.loading-icon').style.display = 'none';
                registerBtn.querySelector('.btn-text').textContent = 'Create Account';
            }
        });

        // Password Reset
        resetPasswordLink.addEventListener('click', async (e) => {
            e.preventDefault();
            const email = prompt('Enter your email address:');
            if (email) {
                try {
                    await sendPasswordResetEmail(auth, email);
                    alert('Password reset email sent! Check your inbox.');
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        });
    </script>
</body>
  </html>
